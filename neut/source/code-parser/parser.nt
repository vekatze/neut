import {
  this.syntax-tree.comment {Comment-item, Line-Comment, comment-item, comment-type},
  zonk.parse {chunk, parsed},
  zonk.zonk-kit {zonk-kit},
}

define is-non-symbol-char(r: rune): bool {
  match r {
  | `=` =>
    True
  | `(` =>
    True
  | `)` =>
    True
  | ` ` =>
    True
  | `\`` =>
    True
  | `"` =>
    True
  | `\n` =>
    True
  | `\t` =>
    True
  | `:` =>
    True
  | `;` =>
    True
  | `,` =>
    True
  | `<` =>
    True
  | `>` =>
    True
  | `[` =>
    True
  | `]` =>
    True
  | `{` =>
    True
  | `}` =>
    True
  | `/` =>
    True
  | `*` =>
    True
  | `|` =>
    True
  | `&` =>
    True
  | `?` =>
    True
  | _ =>
    False
  }
}

define skip-space<r := rho>(k: &zonk-kit): parsed(unit) {
  try _ = r;
  try _ =
    zonk.parse.take-while(function (r) {
      match r {
      | ` ` =>
        True
      | `\n` =>
        True
      | _ =>
        False
      }
    })(k);
  Right(Unit)
}

define skip-space-without-newline<r := rho>(k: &zonk-kit): parsed(unit) {
  try _ = r;
  try _ =
    zonk.parse.take-while(function (r) {
      eq-rune(r, ` `)
    })(k);
  Right(Unit)
}

define parse-comment-item<r := rho>(k: &zonk-kit, comment-type: comment-type): parsed(comment-item) {
  try _ = r;
  try _ = chunk("//")(k);
  try comment-text =
    zonk.parse.take-while(function (r) {
      ne-rune(r, `\n`)
    })(k);
  Right(Comment-item of {comment-text, comment-type})
}

define parse-line-comment<r := rho>(k: &zonk-kit): parsed(comment-item) {
  try _ = r;
  try _ = skip-space(k);
  parse-comment-item(k, Line-Comment)
}
