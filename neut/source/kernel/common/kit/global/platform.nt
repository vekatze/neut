import {
  core.text-builder {append-text, make-text-builder},
  this.app.app {app},
  this.app.run {raise-error', run},
  this.kernel.common.arch {Amd64, Arm64, arch},
  this.kernel.common.operating-system {operating-system},
  this.kernel.common.platform {Platform, platform},
  this.language.common.data-size {data-size},
  this.logger.hint {hint},
  this.logger.logger-kit {logger-kit},
}

data platform-kit {
| _Platform-Kit(
    arch: arch,
    operating-system: operating-system,
    clang-digest: text,
    base-size: data-size,
  )
}

define get-arch(k: &platform-kit): arch {
  tie _Platform-Kit of {arch} = k;
  *arch
}

define get-operating-system(k: &platform-kit): operating-system {
  tie _Platform-Kit of {operating-system} = k;
  *operating-system
}

define get-platform(k: &platform-kit): platform {
  let arch = get-arch(k);
  let operating-system = get-operating-system(k);
  Platform(operating-system, arch)
}

define get-data-size(k: &platform-kit): data-size {
  tie _Platform-Kit of {base-size} = k;
  *base-size
}

define get-clang-digest(k: &platform-kit): &text {
  tie _Platform-Kit of {clang-digest} = k;
  clang-digest
}

define _get-current-arch(): arch {
  introspect architecture {
  | amd64 =>
    this.kernel.common.arch.Amd64
  | arm64 =>
    this.kernel.common.arch.Arm64
  }
}
