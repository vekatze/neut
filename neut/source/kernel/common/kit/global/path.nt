import {
  core.cell {make-cell},
  path.path {split-extension, take-last},
  this.app.app {app},
  this.app.run {raise-error'},
  this.kernel.common.kit.global.platform {platform-kit},
  this.kernel.common.module {Module, extract-module, main-module},
  this.language.common.module-id {Library},
  this.logger.logger-kit {logger-kit},
}

data path-kit {
| _Path-Kit(
    main-module: &main-module,
    cache-cell: cell(?text),
    logger-kit: &logger-kit,
    platform-kit: &platform-kit,
  )
}

define make-path-kit(mm: &main-module, lk: &logger-kit, pk: &platform-kit): path-kit {
  let cache-cell = make-cell(box {none});
  _Path-Kit(mm, cache-cell, lk, pk)
}

define get-base-name(path: &text): text {
  pin bar = take-last(path);
  let Pair(buz, _) = split-extension(bar);
  buz
}

define ensure-not-in-dependency-dir(m: &main-module): app(unit) {
  tie Module of {id} = extract-module(m);
  case id {
  | Library(_) =>
    raise-error'(*"This command cannot be used under a dependency directory")
  | _ =>
    Right(Unit)
  }
}

define zen(): unit {
  pin x = get-base-name("foo/bar/buz.nt");
  vet(x);
}
