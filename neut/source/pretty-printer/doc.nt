data doc {
| Empty
| Text(text, doc)
| Line(int, doc)
| Inline-Comment(text, doc)
}

inline indent: int {
  2
}

inline line: doc {
  Line(0, Empty)
}

inline make-text(t: text): doc {
  Text(t, Empty)
}

inline inline-comment(t: text): doc {
  Inline-Comment(t, Empty)
}

define _join(d1: doc, d2: doc): doc {
  match d1 {
  | Empty =>
    d2
  | Text(t, x) =>
    Text(t, _join(x, d2))
  | Line(i, x) =>
    Line(i, _join(x, d2))
  | Inline-Comment(t, x) =>
    Inline-Comment(t, _join(x, d2))
  }
}

rule-right join {
  function leaf(_: int): doc {
    Empty
  },
  function node-left(d: doc, acc: doc): doc {
    _join(d, acc)
  },
  function root<a>(x: a): a {
    x
  },
}
